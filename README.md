–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–Ω–æ–≥–æ—Ä–∞—É–Ω–¥–æ–≤–æ–π –∞—É–∫—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω–∞ Node.js + TypeScript, –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ –º–µ—Ö–∞–Ω–∏–∫–µ Telegram Gift Auctions.

> **üì∫ –î–ª—è –∂—é—Ä–∏ –∫–æ–Ω–∫—É—Ä—Å–∞:** —Å–º. [`DEMO.md`](DEMO.md) ‚Äî –¥–µ–º–æ-–º–∞—Ç–µ—Ä–∏–∞–ª—ã, –≤–∏–¥–µ–æ, —Ä–∞–±–æ—Ç–∞—é—â–∏–π —Å–∞–π—Ç
(https://youtu.be/Z4OW_gKjAgo) (https://auction-production-cfa9.up.railway.app/)

–¢–ï–°–¢ K6 - https://youtu.be/qpi4NolTZCk

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–¥–ª—è –∂—é—Ä–∏ –∫–æ–Ω–∫—É—Ä—Å–∞)

### –í–∞—Ä–∏–∞–Ω—Ç 1: Docker (–ø–æ–ª–Ω—ã–π —Å—Ç–µ–∫ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π)

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å MongoDB + API + Workers
docker compose -f docker-compose.full.yml up --build
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:
```bash
# –°–æ–∑–¥–∞—Ç—å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
npm install
npm run seed:demo
```

**–ì–æ—Ç–æ–≤–æ!** –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000

### –í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

```bash
# 1. MongoDB
docker compose up -d

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã (API + Workers)
npm run start:all

# 4. –°–æ–∑–¥–∞—Ç—å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ (–≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
npm run seed:demo
```

**–ì–æ—Ç–æ–≤–æ!** –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000

### –ß—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è?

- **API Server** (–ø–æ—Ä—Ç 3000) ‚Äî REST API + UI
- **Worker** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Ä–∞—É–Ω–¥–æ–≤
- **Reconcile Worker** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
- **MongoDB** (–ø–æ—Ä—Ç 27017) ‚Äî replica set –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- **Mongo Express** (–ø–æ—Ä—Ç 8081) ‚Äî –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ë–î

### –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ

–ö–æ–º–∞–Ω–¥–∞ `npm run seed:demo` —Å–æ–∑–¥–∞—ë—Ç:
- 5 —Ç–µ—Å—Ç–æ–≤—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ —Å –±–∞–ª–∞–Ω—Å–∞–º–∏
- –î–µ–º–æ-–∞—É–∫—Ü–∏–æ–Ω —Å –∞–≤—Ç–æ—É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
- –ó–∞–ø—É—Å–∫–∞–µ—Ç –∞—É–∫—Ü–∏–æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## Deploy (SSH, root+password)

–õ–æ–∫–∞–ª—å–Ω–æ (Windows):

```bash
pip install -r contest-auction/deploy/requirements.txt
python contest-auction/deploy/deploy.py
```

## Enterprise-—É—Ä–æ–≤–µ–Ω—å —Ä–µ—à–µ–Ω–∏–π

**–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å:**
- ‚úÖ **Reconcile Worker** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
- ‚úÖ **Compensating Transactions** ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—à–∏–±–æ–∫ capture/release
- ‚úÖ **Optimistic Locking** ‚Äî retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ **Hold/Release/Capture** –º–æ–¥–µ–ª—å –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç–∞–≤–∫–∞–º–∏

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (10/10):**
- ‚úÖ **XSS Protection** ‚Äî —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ UI
- ‚úÖ **Rate Limiting** ‚Äî 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 15 –º–∏–Ω—É—Ç —Å –æ–¥–Ω–æ–≥–æ IP
- ‚úÖ **CORS** ‚Äî –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ –º–µ–∂—Å–∞–π—Ç–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **Helmet** ‚Äî –∑–∞—â–∏—Ç–Ω—ã–µ HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–∏ (CSP, XSS, MIME)
- ‚úÖ **Input Validation** ‚Äî Zod-—Å—Ö–µ–º—ã –¥–ª—è –≤—Å–µ—Ö API endpoints

**–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å:**
- ‚úÖ **55 —Ç–µ—Å—Ç–æ–≤** ‚Äî –ø–æ–∫—Ä—ã—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- ‚úÖ **Prometheus –º–µ—Ç—Ä–∏–∫–∏** ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞–≤–æ–∫ –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- ‚úÖ **Structured logs (JSON)** ‚Äî —É–¥–æ–±–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- ‚úÖ **MongoDB —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** ‚Äî –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π

**–ú–µ—Ö–∞–Ω–∏–∫–∞:**
- ‚úÖ **Multi-round –∞—É–∫—Ü–∏–æ–Ω—ã** ‚Äî –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π –æ—Ç—Å–µ–≤ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- ‚úÖ **Multi-lot** ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–∑–æ–≤ –≤ –æ–¥–Ω–æ–º –∞—É–∫—Ü–∏–æ–Ω–µ
- ‚úÖ **Anti-sniping** ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç —Å—Ç–∞–≤–æ–∫ –≤ –ø–æ—Å–ª–µ–¥–Ω—é—é —Å–µ–∫—É–Ω–¥—É
- ‚úÖ **Tie-breaking** ‚Äî —á–µ—Å—Ç–Ω–∞—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è –ø—Ä–∏ —Ä–∞–≤–Ω—ã—Ö —Å—Ç–∞–≤–∫–∞—Ö
- ‚úÖ **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ retry –æ–ø–µ—Ä–∞—Ü–∏–π

## –ó–∞–ø—É—Å–∫

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å `.env` (—Å–º. `.env.example`) –∏–ª–∏ –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å ‚Äî —Ç–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç—ã –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π Mongo.

```bash
cd contest-auction
npm install
npm run dev
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `npm run dev` –∑–∞–ø—É—Å–∫–∞–µ—Ç API **–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π scheduler** (inline worker), –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Ä–∞—É–Ω–¥—ã.
–ï—Å–ª–∏ –≤—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π –≤–æ—Ä–∫–µ—Ä, –æ—Ç–∫–ª—é—á–∏—Ç–µ inline worker:

```bash
cd contest-auction

# –≤–∞—Ä–∏–∞–Ω—Ç 1
WORKER_INLINE=0 npm run dev

# –≤–∞—Ä–∏–∞–Ω—Ç 2 (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ)
WORKER_EXTERNAL=1 npm run dev
```

–¢–µ—Å—Ç—ã (55 —Ç–µ—Å—Ç–æ–≤):

```bash
cd contest-auction
npm test
```

**–ü–æ–∫—Ä—ã—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:**
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (hold/release/capture)
- –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ race conditions
- Eligibility –∏ –æ—Ç—Å–µ–≤ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- Anti-sniping –∏ –ø—Ä–æ–¥–ª–µ–Ω–∏—è —Ä–∞—É–Ω–¥–æ–≤
- –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–∫—Ü–∏–æ–Ω–æ–≤
- Multi-lot –º–µ—Ö–∞–Ω–∏–∫–∞

UI: `GET http://localhost:3000/`

### MongoDB Replica Set

MongoDB –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ single-node replica set (`rs0`) –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç replica set —á–µ—Ä–µ–∑ `mongo-init.js`. Connection string –≤–∫–ª—é—á–∞–µ—Ç `?replicaSet=rs0`.

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ replica set:

```bash
docker exec -it contest-auction-mongo mongosh --eval "rs.status()"
```

UI: –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Ç—ë–º–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (mobile-first), –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞ —Ä—É—Å—Å–∫–æ–º.

### Dev Mode (UI)

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é UI –≤ User Mode (–º–∏–Ω–∏–º–∞–ª–∏–∑–º). Dev Mode –≤–∫–ª—é—á–∞–µ—Ç Dev Panel.

- query: `/?dev=true`
- hotkey: `Ctrl+Shift+D`
- –∫–Ω–æ–ø–∫–∞ `Dev` –≤ header (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage)

### User Mode (UI) ‚Äî –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1) –û—Ç–∫—Ä–æ–π—Ç–µ UI: `GET http://localhost:3000/`

2) –í –±–ª–æ–∫–µ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
- –∑–∞–¥–∞–π—Ç–µ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–Ω–∏–∫)** –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ;
- (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) **–ø–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å**;
- –≤ —Ä–∞–∑–¥–µ–ª–µ **–°–æ–∑–¥–∞—Ç—å –∞—É–∫—Ü–∏–æ–Ω** –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –Ω–∞–∂–º–∏—Ç–µ **–°–æ–∑–¥–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å**.

3) –î–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –º–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É (–∫–Ω–æ–ø–∫–∞ **–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É**) ‚Äî Dev Mode –Ω–µ –Ω—É–∂–µ–Ω.

4) –°—Ç–∞–≤–∫–∞ –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É **–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É** (bottom-sheet): –º–æ–∂–Ω–æ –≤–≤–æ–¥–∏—Ç—å —Å—É–º–º—É –≤—Ä—É—á–Ω—É—é, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **+1 —à–∞–≥ / +2 —à–∞–≥–∞ / –ú–∞–∫—Å–∏–º—É–º**, –æ—à–∏–±–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ–Ω—è—Ç–Ω—ã–º —è–∑—ã–∫–æ–º.

## Worker (–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥—ã —Ä–∞—É–Ω–¥–æ–≤)

–í –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ:

```bash
cd contest-auction
npm run worker
```

–õ–æ–≥–∏ –≤–æ—Ä–∫–µ—Ä–∞ –ø–∏—à—É—Ç—Å—è –≤ stdout –≤ JSON (—É–¥–æ–±–Ω–æ –¥–ª—è —Å–±–æ—Ä—â–∏–∫–æ–≤ –ª–æ–≥–æ–≤/grep).

–ü–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏:

```bash
cd contest-auction
npm run build
npm run start:worker
```

## Reconcile Worker (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)

Reconcile worker –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–∞ `total = available + held` –¥–ª—è –≤—Å–µ—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∑–∞–≤–∏—Å—à–∏—Ö holds –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞—É–∫—Ü–∏–æ–Ω–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è holds –∞–∫—Ç–∏–≤–Ω—ã–º —Å—Ç–∞–≤–∫–∞–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (auto-fix) –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ä–∞–∑–±–æ—Ä–∞ (manual review) –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤

–ó–∞–ø—É—Å–∫:

```bash
cd contest-auction
npm run reconcile
```

–ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5 –º–∏–Ω—É—Ç (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `RECONCILE_INTERVAL_MS`).

**–ú–æ–¥–µ–ª–∏:**
- `ReconcileIssue` ‚Äî –∑–∞–ø–∏—Å—å –æ–± –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–æ–π –ø—Ä–æ–±–ª–µ–º–µ —Å –¥–µ—Ç–∞–ª—è–º–∏ –∏ —Å—Ç–∞—Ç—É—Å–æ–º (detected/resolved/manual_review)

**Compensating transactions:**
- –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö capture/release –≤ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ ReconcileIssue
- Reconcile worker –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏—Ö –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ
- –ü–æ—Å–ª–µ 3 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ issue –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å—Ç–∞—Ç—É—Å manual_review

Health-check: `GET http://localhost:3000/health`

Prometheus: `GET http://localhost:3000/metrics`

## Multi-lot –∞—É–∫—Ü–∏–æ–Ω—ã

–ê—É–∫—Ü–∏–æ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–æ—Ç–æ–≤ (–ø—Ä–∏–∑–æ–≤). –£—á–∞—Å—Ç–Ω–∏–∫–∏ —Å–æ—Ä–µ–≤–Ω—É—é—Ç—Å—è –∑–∞ top-N –º–µ—Å—Ç, –≥–¥–µ N = `lotsCount`.

### –ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è
- `lotsCount` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–∑–æ–≤/–ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
- `winners` ‚Äî –º–∞—Å—Å–∏–≤ `participantId` –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π (–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏)
- `winningBids` ‚Äî –º–∞—Å—Å–∏–≤ `{ participantId, amount }` —Å —Ñ–∏–Ω–∞–ª—å–Ω—ã–º–∏ —Å—Ç–∞–≤–∫–∞–º–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π

### –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è
–ê—É–∫—Ü–∏–æ–Ω –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∫–æ–≥–¥–∞ `qualified.length <= lotsCount`:
- –í—Å–µ –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º–∏
- Hold –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ capture (—Å–ø–∏—Å–∞–Ω–∏–µ)
- –°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `finished`

### API
- `GET /auctions/:id` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `winners` –∏ `winningBids` –¥–ª—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∞—É–∫—Ü–∏–æ–Ω–æ–≤
- `POST /auctions/:id/cancel` ‚Äî –æ—Ç–º–µ–Ω—è–µ—Ç –∞—É–∫—Ü–∏–æ–Ω –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ hold'—ã —É—á–∞—Å—Ç–Ω–∏–∫–∞–º

Anti-sniping: effective_end_at = max(oldEnd+extend, now+extend) –ø—Ä–∏ —Å—Ç–∞–≤–∫–µ –≤–Ω—É—Ç—Ä–∏ snipingWindow.

UI: –µ—Å–ª–∏ —Ç–∞–π–º–µ—Ä –¥–æ—à—ë–ª –¥–æ 0—Å, –Ω–æ —Å–µ—Ä–≤–µ—Ä –µ—â—ë –Ω–µ –∑–∞–∫—Ä—ã–ª —Ä–∞—É–Ω–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑-–∑–∞ –∑–∞–¥–µ—Ä–∂–∫–∏/–ø—Ä–æ–¥–ª–µ–Ω–∏—è) ‚Äî –≤–º–µ—Å—Ç–æ ¬´0—Å¬ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è ¬´–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è‚Ä¶¬ª –∏ UI —Å–∞–º –¥–µ–ª–∞–µ—Ç —Ä–µ—Ñ–µ—Ç—á.

## Load test (k6)

–¢—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π k6 (–±–µ–∑ Grafana/Prometheus):

```bash
choco install k6
```

1) –ü–æ–¥–Ω—è—Ç—å Mongo:

```bash
cd contest-auction
docker compose up -d
```

2) –ü–æ–¥–Ω—è—Ç—å API (–≤ –æ–¥–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ):

```bash
cd contest-auction
npm install
npm run dev
```

3) –ü–æ–¥–Ω—è—Ç—å worker (–≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ):

```bash
cd contest-auction
npm run worker
```

4) –ü—Ä–æ–≥–Ω–∞—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É (stdout + —Ñ–∞–π–ª —Å summary):

```bash
cd contest-auction
API_BASE_URL=http://localhost:3000/api \
  DURATION_SEC=60 STEADY_VUS=20 SPIKE_VUS=50 SPIKE_LAST_SEC=10 \
  PARTICIPANTS=100 DEPOSIT_AMOUNT=100000 MIN_INCREMENT=10 \
  npm run load
```

Anti-sniping —Ä–µ–∂–∏–º (–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–µ–∫—É–Ω–¥—ã + –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–¥–ª–µ–Ω–∏—è `roundEndsAt`):

```bash
cd contest-auction
API_BASE_URL=http://localhost:3000/api MODE=anti_sniping \
  ANTI_ROUND_DURATION_SEC=20 ANTI_SNIPING_WINDOW_SEC=10 ANTI_SNIPING_EXTEND_SEC=10 ANTI_SNIPING_MAX_EXTENDS=10 \
  DURATION_SEC=30 STEADY_VUS=10 SPIKE_VUS=50 SPIKE_LAST_SEC=8 \
  PARTICIPANTS=100 DEPOSIT_AMOUNT=100000 MIN_INCREMENT=10 LOTS_COUNT=1 \
  npm run load:sniping
```

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞—É–∫—Ü–∏–æ–Ω:

```bash
cd contest-auction
API_BASE_URL=http://localhost:3000/api AUCTION_ID=<auctionId> \
  DURATION_SEC=60 STEADY_VUS=20 SPIKE_VUS=50 SPIKE_LAST_SEC=10 \
  PARTICIPANTS=100 DEPOSIT_AMOUNT=100000 MIN_INCREMENT=10 \
  npm run load
```

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã: stdout; —Ç–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è JSON-–æ—Ç—á—ë—Ç –≤ [`contest-auction/load/summary.json`](contest-auction/load/summary.json:1).

## Bots (–Ω–∞–≥—Ä—É–∑–∫–∞/–¥–µ–º–æ —Å—Ç–∞–≤–æ–∫)

–ó–∞–ø—É—Å–∫ (—Å–µ—Ä–≤–µ—Ä + worker –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–∞—Ö, –∑–∞—Ç–µ–º –±–æ—Ç—ã):

```bash
cd contest-auction
npm run dev
```

```bash
cd contest-auction
npm run worker
```

```bash
cd contest-auction
API_BASE_URL=http://localhost:3000/api \
  BOTS=50 CONCURRENCY=30 DURATION_SEC=60 \
  npm run bots
```

–ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞—É–∫—Ü–∏–æ–Ω:

```bash
cd contest-auction
API_BASE_URL=http://localhost:3000/api AUCTION_ID=<auctionId> \
  BOTS=50 CONCURRENCY=30 DURATION_SEC=60 \
  npm run bots
```

## –ê–≤—Ç–æ—É—á–∞—Å—Ç–Ω–∏–∫–∏ (live –∞—É–∫—Ü–∏–æ–Ω –±–µ–∑ Dev Mode)

–°–µ—Ä–≤–µ—Ä–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞:

```bash
cd contest-auction

# –≤–∫–ª—é—á–∏—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–æ–≤—ã—Ö/–∞–∫—Ç–∏–≤–Ω—ã—Ö –∞—É–∫—Ü–∏–æ–Ω–æ–≤
BOTS_AUTOSTART=1 \
  BOTS_AUTOSTART_STRATEGY=calm \
  BOTS_AUTOSTART_COUNT=20 \
  BOTS_AUTOSTART_TICK_MS=900 \
  npm run dev
```

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏: `calm` / `aggressive`.

–í UI (User Mode) –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞—É–∫—Ü–∏–æ–Ω–∞ –µ—Å—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å **¬´–ê–≤—Ç–æ—É—á–∞—Å—Ç–Ω–∏–∫–∏: –í–∫–ª/–í—ã–∫–ª¬ª**.
–í Dev Mode –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Ä–µ–∂–∏–º/–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ/–∏–Ω—Ç–µ—Ä–≤–∞–ª) ‚Äî –æ–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ –∞—É–∫—Ü–∏–æ–Ω–∞.

## HTTP API (demo)

–ë–∞–∑–∞: `http://localhost:3000/api`

### 1) –¢–µ—Å—Ç–æ–≤—ã–π –¥–µ–ø–æ–∑–∏—Ç

```bash
curl -X POST "http://localhost:3000/api/accounts/u1/deposit" \
  -H "content-type: application/json" \
  -d '{"amount":"1000","currency":"RUB"}'
```

–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞/hold:

```bash
curl "http://localhost:3000/api/accounts/u1?currency=RUB"
```

### 2) –°–æ–∑–¥–∞—Ç—å –∞—É–∫—Ü–∏–æ–Ω

```bash
curl -X POST "http://localhost:3000/api/auctions" \
  -H "content-type: application/json" \
  -d '{
    "code":"A-001",
    "title":"Gift auction demo",
    "currency":"RUB",
    "roundDurationSec":30,
    "minIncrement":"10",
    "topK":3,
    "snipingWindowSec":10,
    "extendBySec":10,
    "maxExtensionsPerRound":10
  }'
```

### 3) –°—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å –∞—É–∫—Ü–∏–æ–Ω

```bash
curl -X POST "http://localhost:3000/api/auctions/<auctionId>/start"
```

### 4) –°–¥–µ–ª–∞—Ç—å/–ø–æ–≤—ã—Å–∏—Ç—å —Å—Ç–∞–≤–∫—É

```bash
curl -X POST "http://localhost:3000/api/auctions/<auctionId>/bids" \
  -H "content-type: application/json" \
  -d '{"participantId":"u1","amount":"100","idempotencyKey":"u1-r1-1"}'
```

### 5) –°—Ç–∞—Ç—É—Å –∞—É–∫—Ü–∏–æ–Ω–∞ (–≤–∫–ª—é—á–∞—è –ª–∏–¥–µ—Ä–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞)

```bash
curl "http://localhost:3000/api/auctions/<auctionId>?leaders=10"
```

### 6) –õ–∏–¥–µ—Ä–±–æ—Ä–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–∞—É–Ω–¥–∞

```bash
curl "http://localhost:3000/api/auctions/<auctionId>/rounds/1/leaderboard?limit=10"
```

### 7) –ó–∞–∫—Ä—ã—Ç—å —Ç–µ–∫—É—â–∏–π —Ä–∞—É–Ω–¥ (demo, –±–µ–∑ scheduler)

```bash
curl -X POST "http://localhost:3000/api/auctions/<auctionId>/rounds/close"
```

## –°–±–æ—Ä–∫–∞ –∏ —Å—Ç–∞—Ä—Ç

```bash
cd contest-auction
npm run build
npm run start
```